nodes:
  - node_id: pdf-extract#1
    title: "PDF内容提取 #1"
    inputs_from:
      - handle: api_token
        value: ${{OO_SECRET:Custom,mineru,api-key}}
        from_flow:
          - input_handle: api_token
      - handle: pdf_url
        from_node:
          - node_id: upload-to-cloud#1
            output_handle: remote_url
      - handle: enable_formula
        value: true
        from_flow:
          - input_handle: enable_formula
      - handle: seed
        value:
      - handle: extra_formats
        value:
      - handle: page_ranges
        value:
      - handle: callback
        value:
      - handle: data_id
        value:
      - handle: language
        value:
      - handle: model_version
        value:
      - handle: enable_table
        value: true
        from_flow:
          - input_handle: enable_table
      - handle: is_ocr
        value: true
        from_flow:
          - input_handle: is_ocr
    task: self::pdf-extract
  - node_id: upload-to-cloud#1
    title: "Upload File to Cloud #1"
    inputs_from:
      - handle: file
        value: /oomol-driver/oomol-storage/oopilot-instructions.pdf
        from_flow:
          []
        from_node:
          - node_id: pre-detection_pdf#1
            output_handle: file
    task: upload-to-cloud::upload-to-cloud
  - node_id: get-task-result#2
    title: "获取任务结果 #2"
    inputs_from:
      - handle: api_token
        value: ${{OO_SECRET:Custom,mineru,api-key}}
      - handle: task_id
        from_node:
          - node_id: pdf-extract#1
            output_handle: task_id
      - handle: max_retries
        value: 60
        from_flow:
          - input_handle: max_retries
    task: self::get-task-result
  - node_id: +python#1
    title: "Python #1"
    icon: ":logos:python:"
    task:
      ui:
        default_width: 450
      inputs_def:
        - handle: response_data
          description: 完整的响应数据
          json_schema:
            type: object
      outputs_def:
        - handle: full_zip_url
          json_schema:
            type: string
      executor:
        name: python
        options:
          entry: scriptlets/+scriptlet#1.py
    inputs_from:
      - handle: response_data
        from_node:
          - node_id: get-task-result#2
            output_handle: task_data
  - node_id: extract_zip#1
    title: "Extract ZIP #1"
    inputs_from:
      - handle: zip_file
        from_node:
          - node_id: url2file#1
            output_handle: file
      - handle: zip_dir
        value: null
      - handle: password
        value: null
    task: zip::extract_zip
  - node_id: list_files_from_folder#1
    title: "List files from folder #1"
    inputs_from:
      - handle: folder
        from_node:
          - node_id: extract_zip#1
            output_handle: output
      - handle: sort
        value: false
      - handle: traverse
        value: false
      - handle: absolute_path
        value: true
    task: oomol-file::list_files_from_folder
  - node_id: markdown-to-epub#1
    title: "Markdown 转 EPUB #1"
    inputs_from:
      - handle: markdown_file
        from_node:
          - node_id: get-md-from-folder#1
            output_handle: markdown_file
      - handle: output_path
        value: /oomol-driver/oomol-storage/epub/hello.epub
        from_flow:
          - input_handle: output_path
      - handle: title
        value: null
        from_flow:
          - input_handle: title
      - handle: author
        value: null
        from_flow:
          - input_handle: author
      - handle: theme
        value: minimal
        from_flow:
          - input_handle: theme
      - handle: cover_image
        value:
        from_node:
          - node_id: pre-detection_pdf#1
            output_handle: cover_image
    task: self::markdown-to-epub
  - node_id: url2file#1
    title: "URL to file #1"
    inputs_from:
      - handle: url
        from_node:
          - node_id: +python#1
            output_handle: full_zip_url
      - handle: saved_folder
        value: null
        from_flow:
          - input_handle: saved_folder
      - handle: ensure_folder
        value: false
      - handle: file_head
        value: null
      - handle: if_existing
        value: override
      - handle: threads_count
        value: 1
      - handle: headers
        value:
          {}
      - handle: cookies
        value:
          {}
      - handle: window_width
        value: 7
      - handle: failure_ladder
        value:
          - 5
      - handle: min_segment_length
        value: 1048576
      - handle: once_fetch_size
        value: 16384
      - handle: timeout
        value: 30
      - handle: retry_times
        value: 0
      - handle: retry_sleep
        value: 0
    subflow: downloader::url2file
  - node_id: pre-detection_pdf#1
    task: self::pre-detection_pdf
    inputs_from:
      - handle: file
        from_flow:
          - input_handle: file
  - node_id: get-md-from-folder#1
    task: self::get-md-from-folder
    inputs_from:
      - handle: file_paths
        from_node:
          - node_id: list_files_from_folder#1
            output_handle: file_paths
inputs_def:
  - handle: file
    json_schema:
      type: string
      ui:widget: file
      ui:options:
        filters:
          - name: PDF
            extensions:
              - pdf
        excludeAll: true
    nullable: false
    executor_name: nodejs
  - handle: api_token
    description: MinerU API Token，从官网申请获取
    json_schema:
      contentMediaType: oomol/secret
      type: string
    value: ${{OO_SECRET:Custom,mineru,api-key}}
    nullable: false
    executor_name: python
  - handle: output_path
    description: 输出的 EPUB 文件保存路径
    json_schema:
      type: string
      ui:widget: save
      ui:options:
        filters:
          - extensions:
              - epub
            name: EPUB
    value: /oomol-driver/oomol-storage/epub/hello.epub
    nullable: false
    executor_name: python
  - handle: title
    json_schema:
      type: string
    nullable: true
    description: 电子书标题（可选，默认使用文件名）
    value:
    executor_name: python
  - handle: author
    json_schema:
      type: string
    nullable: true
    description: 电子书作者（可选）
    value:
    executor_name: python
  - handle: theme
    json_schema:
      type: string
      enum:
        - duokan
        - minimal
      ui:options:
        {}
    nullable: true
    description: EPUB 主题样式（可选，默认为多看风格）
    value: minimal
    executor_name: python
  - handle: is_ocr
    description: 是否启动OCR功能
    json_schema:
      type: boolean
    value: true
    nullable: true
    executor_name: python
  - handle: enable_formula
    description: 是否开启公式识别
    json_schema:
      type: boolean
    value: true
    nullable: true
    executor_name: python
  - handle: enable_table
    description: 是否开启表格识别
    json_schema:
      type: boolean
    value: true
    nullable: true
    executor_name: python
  - handle: max_retries
    json_schema:
      type: number
      ui:options:
        step: 1
      minimum: 30
      exclusiveMinimum: 30
    value:
    nullable: true
    executor_name: python
outputs_def:
  - handle: epub_file
    json_schema:
      type: string
    nullable: false
    executor_name: python
outputs_from:
  - handle: epub_file
    from_node:
      - node_id: markdown-to-epub#1
        output_handle: epub_file
title: PDF to EPUB
description: |-
  将PDF 文件转换为 epub
   电子书格式
